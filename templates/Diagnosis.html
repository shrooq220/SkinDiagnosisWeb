<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='Main.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
  <title>DermaLens â€¢ Diagnosis</title>

  <style>
      :root{
          --brand-brown:#a18664; /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¨Ù†ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ØªØ£Ø´ÙŠØ± */
      }
      /* ØªÙ†Ø³ÙŠÙ‚ Ù„ØªÙˆØ­ÙŠØ¯ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØªÙ…ÙŠÙŠØ² Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ø´Ø·Ø© */
      .navigation .navLinks li a:hover,
      .navigation .navLinks li.active-page > a,
      .navigation .navLinks li.profile-menu.active-page > a {
          color: var(--brand-brown); 
          font-weight: 600;
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
      .profile-menu .dropdown {
          display: none;
      }
      .profile-menu.active .dropdown {
          display: block;
      }


    /* Footer styles - using fixed position from your previous code */
    .site-footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      z-index: 1000;
    }

    /* Styles for profile menu visibility (missing from your current style block) */
    .profile-menu .dropdown {
        display: none;
    }
    .profile-menu.active .dropdown {
        display: block;
    }



  </style>
</head>

<body>
  <div id="diagnosis-hw" class="header-wrapper">
   <header>
        <nav class="navigation container">
            <div class="logo">
                <a href="{{ url_for('diagnosis') }}">DermaLens</a>
            </div>

            <ul class="navLinks">
                <li><a href="{{ url_for('history') }}" data-key="history">History</a></li>
                <li><a href="{{ url_for('community') }}" data-key="community">Community</a></li>
                <li><a href="{{ url_for('about') }}" data-key="about">About</a></li>

                <li class="profile-menu" id="profile-toggle">
                    <a href="#" title="Account Menu" id="profileDropdownToggle"><i class="fa-solid fa-circle-user"></i></a>
                    
                    <div class="dropdown">
                        <a href="{{ url_for('profile') }}" data-key="profile">Profile</a>
                        
                        <div class="separator"></div>

                        <div class="lang-options">
                            <a onclick="switchLang('ar')">Ø¹Ø±Ø¨ÙŠ</a>
                            <a onclick="switchLang('en')">English</a>
                        </div>
                        
                        <div class="separator"></div>
                        
                        <a href="#" onclick="logout()" data-key="logout" id="authLink">Log Out</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <section class="hero">
      <p data-key="diagnosis">Start Diagnosis</p>
      <button class="photo-btn" id="startDiagnosisBtn" data-key="uplaod">Upload Photo</button>
    </section>

  </div>

 

   <footer class="site-footer">
    <div class="container">
      Dermalens. Copyright DERMALENS. All Rights Reserved
    </div>
  </footer>



  <script>
    document.getElementById("startDiagnosisBtn").addEventListener("click", () => {
      const isLoggedIn = localStorage.getItem("loggedIn") === "true";
      if (isLoggedIn) {
        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø± 'predict' Ø£Ùˆ Ù…Ø³Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±ØŒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ app.py
        window.location.href = "{{ url_for('analysis') }}"; 
      } else {
        if (document.documentElement.lang === "ar") {
          alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ.");
        } else {
          alert("You must log in before starting a diagnosis.");
        }

        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ù„Ù…Ø³Ø§Ø± '/' index)
        window.location.href = "{{ url_for('index') }}";
      }
    });


    /* To change the language */
    const translations = {
      ar: {
        history: "Ø§Ù„Ø³Ø¬Ù„",
        community: "Ø§Ù„Ù…Ø¬ØªÙ…Ø¹",
        about: "Ø¹Ù†Ø§",
        logout: "ØªØ³Ø­ÙŠÙ„ Ø®Ø±ÙˆØ¬",
        diagnosis: "Ø¥Ø¨Ø¯Ø£ Ø§Ù„ØªØ´Ø®ÙŠØµ",
        uplaod: "Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©",
        viewhistory: "Ø£Ùˆ Ø§Ø³ØªØ¹Ø±Ø¶ Ø³Ø¬Ù„Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",
        profile: "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ" // âœ… Ø¥Ø¶Ø§ÙØ© Ù„Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      },
      en: {
        history: "History",
        community: "Community",
        about: "About",
        logout: "Logout",
        diagnosis: "Start Diagnosis",
        uplaod: "Uplaod Photo",
        viewhistory: "Or View Your History",
        profile: "Profile" // âœ… Ø¥Ø¶Ø§ÙØ© Ù„Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      }
    };

    function switchLang(lang) {
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";

      document.querySelectorAll("[data-key]").forEach(el => {
        const icon = el.querySelector('i'); // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø­ØªÙ…Ù„Ø©
        const text = translations[lang][el.dataset.key];
        
        if (text) {
             // If there's an icon, keep it and prepend the text
            if (icon) {
                el.innerHTML = '';
                el.appendChild(icon);
                el.appendChild(document.createTextNode(' ' + text));
            } else {
                 el.textContent = text;
            }
        }
      });

      // save the chosen lang in localStorage
      localStorage.setItem("lang", lang);
    }

    const savedLang = localStorage.getItem("lang") || "en";
    switchLang(savedLang);

    // âœ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 4: Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    document.addEventListener('DOMContentLoaded', () => {
        const profileToggle = document.getElementById('profile-toggle');
        
        if (profileToggle) {
            profileToggle.addEventListener('click', function (event) { 
                // Ù…Ù†Ø¹ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                if (event.target.tagName !== 'A' || event.target.id === 'profileDropdownToggle') {
                    event.preventDefault(); 
                }
                this.classList.toggle('active'); 
            });

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.addEventListener('click', (event) => {
                if (!profileToggle.contains(event.target)) {
                    profileToggle.classList.remove('active');
                }
            });
        }
    });

function logout() {
    // ğŸ’¡ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
    localStorage.removeItem('token'); // Ø¥Ø²Ø§Ù„Ø© Ø±Ù…Ø² JWT
    localStorage.removeItem('loggedIn'); // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    
    // ÙŠÙ…ÙƒÙ† ØªØ±Ùƒ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø£Ùˆ Ø­Ø°ÙÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ø±ØºØ¨Ø©
    const lang = localStorage.getItem('lang') || 'en';
    alert(lang === 'ar' ? 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­.' : 'Logged out successfully.');
    
    // ğŸ’¡ Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø± Flask Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
    window.location.href = "{{ url_for('logout') }}";
}

  </script>
</body>

</html>